# 紧急医疗信息卡 - 输出格式说明

## 支持的输出格式

### 0. HTML格式（推荐）

**文件扩展名**: `.html`

**用途**: 可打印、可分享的网页格式（最推荐）

**特点**:
- 独立文件（所有依赖通过CDN）
- 打印优化（支持A4、钱包卡、大字版）
- 响应式设计
- 使用Tailwind CSS和Lucide图标
- 自动卡片类型检测
- 离线可用（一旦加载）

**数据结构**:
HTML文件包含以下章节：
- 标题栏（生成日期、过期日期、卡片类型）
- 基本信息卡片（姓名、年龄、血型、体重、身高）
- 严重过敏章节（仅3-4级，红色警告）
- 当前用药章节（活跃药物列表）
- 医疗状况章节（慢性疾病列表）
- 植入物章节（如适用）
- 紧急联系人章节
- 免责声明

**卡片类型**:
- **标准版**: 适用于大多数成年人
- **儿童版**: 适用于18岁以下，包含学校信息
- **老年版**: 适用于65岁以上，大字体、高对比度
- **严重过敏版**: 过敏信息突出显示，包含急救说明

**打印尺寸**:
- **A4标准**: 完整信息，适合打印或PDF存档
- **钱包卡**: 74mm × 105mm，仅关键信息，适合随身携带
- **大字版**: A4尺寸但字体更大（16-18pt），适合老年人

**使用场景**:
- 打印携带（推荐）
- 手机保存（离线可用）
- 分享给医生（专业呈现）
- 长期存档（可搜索）
- 快速访问（一键打印）

**使用示例**:
```bash
# 生成HTML卡片（自动检测类型）
python scripts/generate_emergency_card.py

# 生成特定类型
python scripts/generate_emergency_card.py child

# 生成钱包卡尺寸
python scripts/generate_emergency_card.py standard wallet

# 生成大字版
python scripts/generate_emergency_card.py elderly large
```

**优势**:
- ✅ 无需安装任何软件
- ✅ 跨平台兼容（Windows、Mac、Linux）
- ✅ 可直接打印或另存为PDF
- ✅ 响应式设计，手机也能查看
- ✅ 专业美观的视觉效果
- ✅ 打印时自动隐藏按钮和边框

**技术栈**:
- Tailwind CSS v3.4（CDN）
- Lucide Icons v0.263（CDN）
- 纯HTML + CSS（无JavaScript框架）

---

### 1. JSON格式

**文件扩展名**: `.json`

**用途**: 结构化数据存储，便于系统集成和程序处理

**数据结构**:
```json
{
  "emergency_card": {
    "version": "1.0",
    "generated_at": "2025-12-31T12:34:56Z",
    "expires_at": "2026-03-31T12:34:56Z",
    "basic_info": {
      "name": "张三",
      "age": 35,
      "gender": "男",
      "blood_type": "A+",
      "weight": "70kg",
      "height": "175cm",
      "bmi": 22.9
    },
    "critical_allergies": [...],
    "current_medications": [...],
    "medical_conditions": [...],
    "implants": [...],
    "recent_procedures": [...],
    "recent_radiation_exposure": {...},
    "emergency_contacts": [...],
    "qr_code": "data:image/png;base64,...",
    "disclaimer": "此信息卡仅供参考，不替代专业医疗诊断",
    "data_source": "my-his个人健康信息系统"
  }
}
```

**字段说明**:
- `version`: 信息卡版本号
- `generated_at`: 生成时间（ISO 8601格式）
- `expires_at`: 过期时间（建议3个月后重新生成）
- `basic_info`: 基础信息对象
- `critical_allergies`: 严重过敏数组（仅包含3-4级）
- `current_medications`: 当前用药数组（仅active=true）
- `medical_conditions`: 医疗状况数组
- `implants`: 植入物数组
- `recent_procedures`: 近期手术/操作数组
- `recent_radiation_exposure`: 近期辐射暴露对象
- `emergency_contacts`: 紧急联系人数组
- `qr_code`: 二维码图片（Base64编码）
- `disclaimer`: 免责声明
- `data_source`: 数据来源标识

**使用场景**:
- 云盘备份
- 数据迁移
- 系统集成
- 程序处理

---

### 2. 文本格式

**文件扩展名**: `.txt`

**用途**: 易读易打印，适合随身携带

**布局结构**:
```
╔═══════════════════════════════════════════════════════════╗
║                  紧急医疗信息卡                          ║
╠═══════════════════════════════════════════════════════════╣
║ 姓名：[姓名]                    年龄：[年龄]岁           ║
║ 血型：[血型]                   体重：[体重]              ║
╠═══════════════════════════════════════════════════════════╣
║ 🆘 严重过敏                                              ║
║ ─────────────────────────────────────────────────────── ║
║ • [过敏原] - [严重程度]（[级别]级）                     ║
║   反应：[反应描述]                                      ║
╠═══════════════════════════════════════════════════════════╣
║ 💊 当前用药                                              ║
║ ─────────────────────────────────────────────────────── ║
║ • [药物名] [剂量] - [频率]，[目的]                      ║
╠═══════════════════════════════════════════════════════════╣
║ 🏥 医疗状况                                              ║
║ ─────────────────────────────────────────────────────── ║
║ • [疾病名]（[诊断日期]诊断）- [状态]                    ║
╠═══════════════════════════════════════════════════════════╣
║ 📿 植入物（如有）                                        ║
║ ─────────────────────────────────────────────────────── ║
║ • [植入物类型]（[植入日期]植入）                         ║
║   医院：[医院名称]                                      ║
║   注意：[注意事项]                                      ║
╠═══════════════════════════════════════════════════════════╣
║ 📞 紧急联系人                                            ║
║ ─────────────────────────────────────────────────────── ║
║ • [姓名]（[关系]）- [电话号码]                          ║
╠═══════════════════════════════════════════════════════════╣
║ ⚠️  免责声明                                            ║
║ 此信息卡仅供参考，不替代专业医疗诊断                     ║
║ 生成时间：[YYYY-MM-DD HH:MM:SS]                          ║
╚═══════════════════════════════════════════════════════════╝
```

**特点**:
- 使用Unicode框线字符绘制边框
- 清晰的层次结构
- 图标增强可读性
- 适合打印（A4纸张）

**打印建议**:
- **钱包卡**: 缩小至50%，裁剪后放钱包
- **冰箱贴**: 放大至120%，贴冰箱门
- **随身卡**: 缩小至80%，过塑后耐用

---

### 3. 二维码格式

**文件扩展名**: `.png`

**用途**: 手机扫描快速访问完整信息

**生成方式**:
1. 将JSON数据压缩（可选）
2. 使用QR码生成库生成图片
3. 保存为PNG格式

**二维码规格**:
- **版本**: Version 40（最大容量）
- **纠错级别**: H（30%纠错）
- **尺寸**: 400×400像素
- **格式**: PNG（便携式网络图形）

**数据内容**（选择一种）:

**方式1: 完整JSON**
```
{"emergency_card":{...完整的JSON对象}}
```
- 优点: 无需网络，直接解码
- 缺点: 二维码较复杂，扫描可能困难

**方式2: 短链接**
```
https://example.com/emergency/card?id=xxx
```
- 优点: 二维码简单，易扫描
- 缺点: 需要网络，依赖服务器

**推荐**: 使用方式1（完整JSON），确保离线可用

**使用场景**:
- 手机相册保存
- 手环/项链吊牌
- 钱包卡背面
- 医疗手环

**扫描方式**:
- iOS: 相机扫描
- Android: 微信/支付宝扫描
- 专用QR码扫描器

---

### 4. PDF格式

**文件扩展名**: `.pdf`

**用途**: 专业打印，长期存档

**页面布局**:
- **页面大小**: A4（210×297mm）
- **方向**: 纵向
- **边距**: 上下左右各20mm
- **字体**: 黑体/宋体，标题18pt，正文12pt

**内容组织**:
```
第1页: 紧急信息摘要
├─ 标题和生成日期
├─ 基础信息卡片
├─ 严重过敏警示
├─ 当前用药列表
├─ 医疗状况列表
└─ 紧急联系人

第2页（如需要）: 详细信息
├─ 植入物详情
├─ 近期手术记录
├─ 近期辐射暴露
├─ 用药相互作用警示
└─ 就医注意事项
```

**PDF特性**:
- 支持中文
- 支持复制粘贴
- 支持搜索
- 不可编辑（保护信息）

**使用场景**:
- 就诊时打印给医生
- 医院档案存档
- 旅行签证材料
- 保险公司理赔

---

## 输出格式选择指南

### 按使用场景选择

| 使用场景 | 推荐格式 | 备用格式 |
|---------|---------|---------|
| **手机保存** | 二维码（PNG） | JSON |
| **随身携带** | 文本版（缩小打印） | 二维码 |
| **冰箱/家门** | 文本版（放大打印） | - |
| **旅行准备** | 二维码 + 文本版 | JSON |
| **就诊准备** | PDF | 文本版 |
| **云盘备份** | JSON | PDF |
| **数据迁移** | JSON | - |
| **分享给医生** | PDF | 文本版 |
| **紧急情况** | 二维码 + 文本版 | - |

### 按设备选择

| 设备 | 推荐格式 | 原因 |
|------|---------|------|
| **智能手机** | 二维码（PNG） | 扫描快速，信息完整 |
| **功能手机** | 文本版（TXT） | 无需扫描，直接读取 |
| **平板电脑** | PDF | 阅读体验好 |
| **电脑** | JSON/PDF | 便于处理和打印 |
| **打印纸张** | 文本版/PDF | 清晰易读 |

---

## 特殊格式变体

### 儿童专用格式

**特点**:
- 包含学校和年级信息
- 家长联系方式优先
- 学校医务室联系方式
- 教师注意事项

```json
{
  "basic_info": {
    "name": "王小明",
    "age": 8,
    "school": "XX小学",
    "grade": "二年级",
    "class": "2班"
  },
  "school_contacts": [
    {"role": "班主任", "name": "张老师", "phone": "138****1234"},
    {"role": "校医", "name": "李医生", "phone": "010-****5678"}
  ],
  "school_instructions": [...]
}
```

### 老年人专用格式

**特点**:
- 大字体（18-20pt）
- 高对比度配色
- 独居标识
- 社区医生联系方式
- 邻居联系方式

```
╔═══════════════════════════════════════════════════════════╗
║           👴 老人急救信息卡（请放大查看）👴              ║
╠═══════════════════════════════════════════════════════════╣
║ 👤 姓名：王五                    年龄：75岁（独居）      ║
║ 🅰️ 血型：B+                                             ║
╠═══════════════════════════════════════════════════════════╣
║ 🆘 严重过敏（紧急）                                      ║
║ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ ║
║ 【大字】磺胺类药物 - 严重过敏（3级）                    ║
║        反应：全身皮疹、发热                              ║
╠═══════════════════════════════════════════════════════════╣
║ 📞 紧急联系人（请立即拨打）                             ║
║ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ ║
║ 【大字】儿子：王先生 - 139****5678                     ║
║        社区医生：李医生 - 010-****1234                 ║
║        邻居：张阿姨 - 136****9876                      ║
╚═══════════════════════════════════════════════════════════╝
```

### 严重过敏专用格式

**特点**:
- 过敏信息置顶加粗
- 包含交叉过敏警示
- 详细的过敏急救流程
- 药物禁忌列表

```
╔═══════════════════════════════════════════════════════════╗
║         🆘🆘🆘 严重过敏警示 🆘🆘🆘                       ║
╠═══════════════════════════════════════════════════════════╣
║ ⛔ 绝对禁止：青霉素及所有相关药物                       ║
╠═══════════════════════════════════════════════════════════╣
║ 过敏原：青霉素                                          ║
║ 严重程度：过敏性休克（4级）🆘                           ║
║ 诊断日期：2010-05-15                                    ║
╠═══════════════════════════════════════════════════════════╣
║ ⚠️  交叉过敏警示：                                      ║
║ • 头孢菌素类抗生素（需谨慎使用）                         ║
║ • 可能与青霉素有交叉过敏反应                            ║
╠═══════════════════════════════════════════════════════════╣
║ 🆘 过敏急救流程：                                       ║
║ 1. 立即停止接触可疑过敏原                               ║
║ 2. 立即拨打120                                          ║
║ 3. 如有肾上腺素自动注射器，立即使用                      ║
║ 4. 保持呼吸道通畅，等待救援                              ║
╚═══════════════════════════════════════════════════════════╝
```

---

## 文件命名规范

### 标准命名
```
emergency-card-YYYY-MM-DD.{ext}
```
示例：
- `emergency-card-2025-12-31.json`
- `emergency-card-2025-12-31.txt`
- `emergency-card-2025-12-31.png`
- `emergency-card-2025-12-31.pdf`

### 特殊命名

**儿童专用**:
```
emergency-card-child-{name}-YYYY-MM-DD.{ext}
```

**老年人专用**:
```
emergency-card-elderly-{name}-YYYY-MM-DD.{ext}
```

**严重过敏专用**:
```
emergency-card-allergy-{name}-YYYY-MM-DD.{ext}
```

---

## 生成频率建议

| 人群 | 建议更新频率 | 触发条件 |
|------|-------------|---------|
| **健康成人** | 每6个月 | 健康信息变化 |
| **慢性病患者** | 每3个月 | 用药调整 |
| **严重过敏** | 每月 | 过敏测试结果 |
| **老年人** | 每3个月 | 健康状况变化 |
| **儿童** | 每学期 | 新学期开始 |
| **旅行前** | 出发前1周 | - |
| **手术前** | 术前1天 | - |

---

## 输出示例汇总

完整的示例输出请参考：
- [examples.md](examples.md) - 各种使用场景的完整示例
- [test-data/emergency-example.json](test-data/emergency-example.json) - 标准JSON示例
